
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>It's an imperative, mutable world out there - dave^2 = -1</title>
  <meta name="author" content="David Tchepak">

  
  <meta name="description" content="I’ve heard Erik Meijer quoted as saying the world is imperative and mutable, and so we should embrace side-effects1. I’ve also heard what I interpret &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://davesquared.net/2012/09/imperative-world.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!-- MathJax config based on http://docs.mathjax.org/en/latest/config-files.html#the-mml-htmlormml-configuration-file
       (local mathjax derived from https://ro-che.info/articles/2017-04-02-deploying-mathjax) -->
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    config: ["MMLorHTML.js"],
    jax: ["input/MathML","output/HTML-CSS","output/NativeMML"],
    extensions: ["mml2jax.js"],
    "HTML-CSS": {
      availableFonts: ["TeX"],
      imageFont: null
    },
    MathMenu: {
       showRenderer: false,
       showFontMenu: false,
       showLocale: false
    }
  });
  </script>
  <script type="text/javascript" src="/javascripts/mathjax-2.7.0/MathJax.js"></script>
  <link href="http://feeds2.feedburner.com/davesquared" rel="alternate" title="dave^2 = -1" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2217573-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body  class="no-sidebar">
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds2.feedburner.com/davesquared" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<!-- Google CSE Search Box Begins  -->
<form id="searchbox_005697633880271604295:snlx0l0dwf0" action="http://www.google.com/cse" onsubmit="davesquared_submitSearchBoxWidget()">
  <fieldset role="search">
  <input value="005697633880271604295:snlx0l0dwf0" name="cx" type="hidden"/>
  <input value="" name="cof" type="hidden"/>
  <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<!-- Google CSE Search Box Ends -->
<script type="text/javascript">
function davesquared_submitSearchBoxWidget() {
  var searchBox = document.getElementById("searchbox_005697633880271604295:snlx0l0dwf0");
  searchBox.action = "/search";
  searchBox.cof.value="FORID:11";
}
</script>
  
<ul class="main-navigation">
  <li><a href="/" class="siteHome">dave^2 = -1</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/categories">Categories</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">It's an imperative, mutable world out there</h1>
    
    
      <p class="meta">
        








  



<time datetime="2012-09-11T10:05:00+10:00" pubdate data-updated="true">11 Sep 2012</time> 
      </p>
    
  </header>


<div class="entry-content"><p>I’ve heard Erik Meijer quoted as saying the world is imperative and mutable, and so we should embrace side-effects<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. I’ve also heard what I interpret as pretty much the opposite from Rich Hickey<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. So, which is it?</p>
<p>I’m not sure, but maybe a story about dinosaurs will help.</p>
<h2 id="somehow-we-all-escaped-with-our-lives">Somehow we all escaped with our lives</h2>
<p>It was a brisk winter’s night. I had just parked my car down at The Rocks, a beautiful part of Sydney right on the Harbour, and had started hurrying down George Street to attend the monthly Drop Bear Awareness Society meetup. I had only gone a couple of hundred metres when hordes of people started flooding out of Circular Quay directly across the road from me, accompanied by yells, screams and sirens. I was swept along with the crowd, herded by police and emergency services into Town Hall station and onto waiting trains. As my train pulled away from the platform I only knew one thing for certain; people were talking about a “monster” with a disturbing amount of credulity.</p>
<p>Turns out that a 50 metre high dinosaur-like monster had chosen that day to emerge from the depths of Sydney Harbour and take a brief stroll through the CBD. It was apparently on land for about 10 minutes, after which time it had grown bored and decided go head to Melbourne where it could destroy something more tasteful.</p>
<p>I returned to my car the next day. It was flattened; the imprint of a giant footprint clearly visible in the twisted wreckage. But I wasn’t going to give up on my beloved car. It took weeks of extensive work at the smash repairer, but I finally got my car back, pretty much as good as new.</p>
<h2 id="state-mutations-and-time">State, mutations and time</h2>
<p>There are two ways of looking at this story (three if you count “as an unimaginative, poorly-told piece of tripe”). One is from the perspective of mutable state, as commonly associated with imperative programming<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. I had a working car, then the car’s state changed to “smashed by monstrous dinosaur”, then it changed back to working. It was the same car, its state was just changed, and rather forcibly at that. We can even write a program to express what happened:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<pre><code class='csharp'><span></span><span class="kt">var</span> <span class="n">car</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Car</span><span class="p">(</span><span class="s">&quot;British Leyland Mini 1000&quot;</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">car</span><span class="p">.</span><span class="n">State</span><span class="p">);</span> <span class="c1">// prints &quot;Working&quot;</span>
<span class="n">car</span><span class="p">.</span><span class="n">SmashWith</span><span class="p">(</span><span class="k">new</span> <span class="n">DinosaurThing</span><span class="p">());</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">car</span><span class="p">.</span><span class="n">State</span><span class="p">);</span> <span class="c1">// prints &quot;Smashed&quot;</span>
<span class="n">car</span><span class="p">.</span><span class="n">Repair</span><span class="p">();</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">car</span><span class="p">.</span><span class="n">State</span><span class="p">);</span> <span class="c1">// prints &quot;Working&quot;</span>
</code></pre>
</div>
</figure>
</notextile>
</div>
<p>The <code>SmashWith</code> and <code>Repair</code> methods have side-effects; they mutate the <code>State</code> property of the car as the program executes. One interesting result of this is that the <code>State</code> property is always tied to the concept of “now”; its value is inextricably linked to the point in time at which it is called. We have several states in this program, but whenever we talk about state, we are only referring to the current state.</p>
<p>I tend to think of the concept of time being an <em>implied</em> part of this representation. Any state change requires a change in time, but this representation never refers to time explicitly. The time is always “now”, and evaluating the next statement is always done in that context. From the perspective of “now”, this representation is completely valid.</p>
<p>For programming in particular though, this perspective is not without its problems. Because time is implicit in this representation, “now” changes from instruction to instruction, and so it is possible for operations to interfere. Any contention for the state between operations, such as concurrent access (multi-threading) or temporal coupling (<code>Repair</code> only makes sense when the car is smashed after a call to <code>SmashWith</code>) can result in an inconsistent state. To reason about a program, we also have to mentally evaluate it by stepping through all the instances of “now” that can occur.</p>
<p>There is another, equally valid way of thinking about this story. In this telling we make the time variable explicit. The state of the car is a function of time:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<pre><code class='csharp'><span></span><span class="k">public</span> <span class="k">static</span> <span class="n">CarState</span> <span class="nf">GetCarState</span><span class="p">(</span><span class="n">Time</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">CarState</span> <span class="n">InitialState</span> <span class="p">=</span> <span class="n">CarState</span><span class="p">.</span><span class="n">Working</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">CarState</span> <span class="n">SmashedByDinosaur</span> <span class="p">=</span> <span class="n">CarState</span><span class="p">.</span><span class="n">Smashed</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">CarState</span> <span class="n">RepairedState</span> <span class="p">=</span> <span class="n">CarState</span><span class="p">.</span><span class="n">Working</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">InitialState</span><span class="p">;</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">t</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">t</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SmashedByDinosaur</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">RepairedState</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
</figure>
</notextile>
</div>
<p>Here we still have state changes, but they aren’t destructive. Just because my car is now fixed does not mean that is was never smashed by a giant, 50 metre high mostrosaur. That state was still perfectly valid, it was just at a different time. Because time is an explicit input it is not possible to get interfering states. The output depends purely on the input, and is defined for all values of <code>t</code>.</p>
<p>One effect of treating state as a function of time is that data necessarily becomes immutable. Once we have data for some time <code>t</code>, that data is never going to change; we can’t change the past. A change in state over time will result in a new piece of data.</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<pre><code class='csharp'><span></span><span class="k">public</span> <span class="k">static</span> <span class="n">Car</span> <span class="nf">GetCar</span><span class="p">(</span><span class="n">Time</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Works nicer in a lazy / non-strict language... :)</span>
    <span class="kt">var</span> <span class="n">car</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Car</span><span class="p">(</span><span class="s">&quot;British Leyland Mini 1000&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">smashedCar</span> <span class="p">=</span> <span class="n">car</span><span class="p">.</span><span class="n">SmashWith</span><span class="p">(</span><span class="k">new</span> <span class="n">DinosaurThing</span><span class="p">());</span>
    <span class="kt">var</span> <span class="n">repairedCar</span> <span class="p">=</span> <span class="n">smashedCar</span><span class="p">.</span><span class="n">Repair</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">car</span><span class="p">;</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">time</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">t</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span> <span class="k">return</span> <span class="n">smashedCar</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">repairedCar</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
</figure>
</notextile>
</div>
<p>And just because we can explicitly handle time does not mean we have to expose it. Immutable data is enough to ensure we don’t interfere with previous states:</p>
<div class="bogus-wrapper">
<notextile>
<figure class="code">
<figcaption>
<span></span>
</figcaption>
<div class="highlight">
<pre><code class='csharp'><span></span><span class="kt">var</span> <span class="n">car</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Car</span><span class="p">(</span><span class="s">&quot;British Leyland Mini 1000&quot;</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">smashedCar</span> <span class="p">=</span> <span class="n">car</span><span class="p">.</span><span class="n">SmashWith</span><span class="p">(</span><span class="k">new</span> <span class="n">DinosaurThing</span><span class="p">());</span>
<span class="kt">var</span> <span class="n">repairedCar</span> <span class="p">=</span> <span class="n">smashedCar</span><span class="p">.</span><span class="n">Repair</span><span class="p">();</span>
</code></pre>
</div>
</figure>
</notextile>
</div>
<p>One thing that may seem troubling is we now have different instances of data representing the one car, but we can associate these using identity (the car’s VIN, make, model, etc.) rather than by reference as per the mutable-imperative approach. The state of a car with a specific identity can be considered a function of time and identity with an immutable data representation as the output. Again, all these states are valid, they actually occurred in the story, and we just need to be explicit on which moment of reality we need to work with.</p>
<h2 id="imperative-world">Imperative world?</h2>
<p>So the world is imperative, full of mutations and side-effects. But it seems equally valid to say that the world is a function of time (and other variables) that outputs immutable states. Perhaps both perspectives are two sides of the same coin, just separated by their treatment of time.</p>
<p>To me the potential equivalence of these perspectives matches my admittedly-basic-and-quite-probably-wrong interpretation of the <a href="http://en.wikipedia.org/wiki/Church%E2%80%93Turing_thesis">Church-Turing thesis</a>: all computable programs are computable by both a Turing machine and using the λ-calculus. A Turing machine relies on mutable state, λ-calculus on pure functions. They’re all able to express the same set of programs, and they can all represent “real world” information and calculations.</p>
<p>The question for programmers is which perspective on state makes programs easier to reason about and work with. And if the answer varies from problem to problem, what particular aspects of a problem make it well-suited to that perspective?</p>
<h2 id="intuition">Intuition</h2>
<p>One thing to consider before you answer is how much of our opinion is swayed by what John Backus referred to as “the primacy of the von Neumann computer”<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<p>Most of us have been trained from our very first experience with a computer (Assembler? C? C64 Basic? Java?) until now to think about programs in terms of the von Neumann architecture, where we process an instruction at a time and store to and load from mutable registers. In evaluating these perspectives we need to overcome decades of language and architecture bias. Both perspectives are equally valid when talking about the world around us, both can express the entire set of computable programs, and yet most platforms and languages emphasise mutability.</p>
<p>So it seems reasonable to be a little suspect of both our intuition and of the status quo in this case. Intuitively we understand that things change their state, but logically we also recognise that state depends on time, and a new state at a particular time does not destroy the state at the previous time.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In summary, don’t park right next to a large, city-side harbour unless you have comprehensive car insurance.</p>
<p>And let’s challenge ourselves about the idea that mutability is somehow essential to programming and to expressing concepts from the “real world”.</p>
<p>But mainly the parking thing.</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Erik Meijer from GOTO Night August 23, 2012 in Chicago: <a href="https://twitter.com/codemiller/status/238780672439885824">one</a>, <a href="https://twitter.com/codemiller/status/238783944043151360">two</a>, <a href="https://twitter.com/puffnfresh/status/238779939053252608">three</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p><a href="http://www.infoq.com/presentations/Value-Values">Rich Hickey, GOTO 2012 Keynote: The Value of Values</a><a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Imperative programs are just sequences of instructions and can also be done without mutable state, although <a href="http://en.wikipedia.org/wiki/Imperative_programming">some definitions</a> include mutability as an essential feature.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>“Can Programming Be Liberated from the von Neumann Style? A Functional Style and Its Algebra of Programs”, John Backus, Communications of the ACM August 1978. <a href="http://www.cs.cmu.edu/~crary/819-f09/Backus78.pdf">PDF link</a><a href="#fnref4" class="footnote-back">↩</a></p></li>
</ol>
</section>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Tchepak</span></span>

      








  



<time datetime="2012-09-11T10:05:00+10:00" pubdate data-updated="true">11 Sep 2012</time>
      

<span class="categories">
  
    <a class='category' href='/categories/imho/'>imho</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://davesquared.net/2012/09/imperative-world.html" data-via="" data-counturl="http://davesquared.net/2012/09/imperative-world.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/08/reader-monad.html" title="Previous Post: Reader monad">&laquo; Reader monad</a>
      
      
        <a class="basic-alignment right" href="/2012/10/state-monad.html" title="next Post: State monad">State monad &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <footer role="contentinfo"><p class="disclaimer">All code and advice is provided without warranty -- use at your own risk! This is just a blog! Don't take it too seriously!<br/>
Despite not being too serious, this blog has a <a href="http://davesquared.net/2007/07/privacy-policy.html">Privacy Policy</a>, because it uses Google Analytics to see if anyone drops by.</p>
<p>
  Copyright &copy; 2022 - David Tchepak -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

  
<script type="text/javascript">
      var disqus_shortname = 'davesquared';
        // var disqus_developer = 1;
        var disqus_identifier = 'http://davesquared.net/2012/09/imperative-world.html';
        var disqus_url = 'http://davesquared.net/2012/09/imperative-world.html';
        var disqus_script = 'embed.js';
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'https://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
